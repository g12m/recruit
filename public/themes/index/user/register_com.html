<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta name='renderer' content='webkit'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
    <title></title>
</head>
<link rel="stylesheet" href="__TMPL__/public/assets/css/default/layui/css/layui.css">
<link rel='stylesheet' href='__TMPL__/public/assets/css/default/index.css'>
<script src='__TMPL__/public/assets/js/default/jquery-1.11.3.min.js'></script>
<script src='__TMPL__/public/assets/css/default/layui/layui.all.js'></script>
<script src='__TMPL__/public/assets/js/default/SuperSlide.js'></script>
<script src='__TMPL__/public/assets/js/default/index.js'></script>
<script type="text/javascript">
    //全局变量
    var GV = {
        ROOT: "__ROOT__/",
        WEB_ROOT: "__WEB_ROOT__/",
        JS_ROOT: "static/js/"
    };
</script>
<script src="__STATIC__/js/wind.js"></script>
<body style="background: url(__TMPL__/public/assets/images/default/bg_clear.jpg)" class="register-form">
    <div class="center">
        <a href="/"><img class="logo" src="__TMPL__/public/assets/images/default/logo_h.png" alt=""></a>
        <div class="register">
            <p class="register-h">注册企业账号</p>
            <div class="form">
                <form action="{:url('user/Register/doRegister')}" method="POST" class="js-ajax-form">
                    <div class="form-h">账号信息</div>
                    <div class="form-m">
                        <div class="layui-form-item">
                            <label class="layui-form-label">账号：</label>
                            <div class="layui-input-block">
                                <input type="text" name="username" required lay-verify="required" placeholder="请输入手机号或邮箱"
                                    autocomplete="off" class="layui-input">
                                <div class="layui-btn fsyzm">发送验证码</div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">验证码：</label>
                            <div class="layui-input-block">
                                <input type="text" name="code" required lay-verify="required" placeholder="请输入验证码"
                                    autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">密码：</label>
                            <div class="layui-input-block">
                                <input type="password" name="password" required lay-verify="required"
                                    placeholder="请输入密码" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">确认密码：</label>
                            <div class="layui-input-block">
                                <input type="password" name="pwd" required lay-verify="required"
                                    placeholder="请再次输入密码" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="form-h">联系人信息</div>
                    <div class="form-m">
                        <div class="layui-form-item">
                            <label class="layui-form-label">联系人：</label>
                            <div class="layui-input-block">
                                <input type="text" name="user_name" required lay-verify="required" placeholder="请输入联系人姓名"
                                    autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">联系人电话：</label>
                            <div class="layui-input-block">
                                <input type="text" name="phone" required lay-verify="required"
                                    placeholder="请输入联系人电话" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="form-h">企业信息</div>
                    <div class="form-m">
                        <div class="layui-form-item">
                            <label class="layui-form-label">企业名称：</label>
                            <div class="layui-input-block">
                                <input type="text" name="ent_name" required lay-verify="required"
                                    placeholder="请输入企业名称" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">企业地址：</label>
                            <div class="layui-input-block">
                                <select class=" province" name="province">
                                </select>
                                <select class=" city" name="city">
                                </select>
                                <select class=" area" name="area">
                                </select>
                            </div>
                            <script src="__TMPL__/public/assets/js/default/jsAddress.js"></script>
                            <script>
                                addressInit('province', 'city', 'area');
                            </script>
                        </div>
                        <div class="layui-form-item width">
                            <label class="layui-form-label">所在行业：</label>
                            <div class="layui-input-block">
                                <input type="text" name="Industry" required lay-verify="required"
                                    placeholder="请输入企业所在行业" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item width" style="float:none;">
                            <label class="layui-form-label">企业简介：</label>
                            <div class="layui-input-block">
                                <textarea name="desc" required lay-verify="required" placeholder="请输入企业简介"
                                    class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="sctp width">
                            <label> 上传营业执照：</label>
                            <div class="scinput">
                                <input type="text" class="scbtn" id="yyzz" name="img" onclick="document.getElementById('file-up').click();">
                                <img class="img" id="demo1" src="__TMPL__/public/assets/images/default/sc.png" alt="">
                            </div>
                            <span>请上传大小20M以下的JPG PNG GIF图片</span>
                                <input type="file" id="file-up" onchange="fileUp(this)" name="file" accept="image/*" style="display: none;">
                        </div>
                        <div class="zc">
                            <button class="layui-btn js-ajax-submit" type="submit">注 册</button>
                        </div>
                        <input name="user_type" value="4" type="hidden">
                    </div>
                    <script src="__STATIC__/js/base64image.js" type="text/javascript"></script>
                    <script src="__STATIC__/js/exif.js" type="text/javascript"></script>
                </form>
            </div>
        </div>
        <script src="__STATIC__/js/admin.js"></script>
        <div class="copy">{:cmf_get_option('server_settings')['q_banquan']}</div>
    </div>
    <script>
        //压缩过的base64
        var fileUp = function (me) {
            base64Image({
                width: 500,                             /*【选填】宽度默认750，如果图片尺寸大于该宽度，图片将被设置为该宽度*/
                ratio: 0.75,                            /*【选填】压缩率默认0.75 */
                file: me,                              /*【必填】对应的上传元素 */
                callback: function (imageUrl) {        /*【必填】处理成功后的回调函数 */
                    /*imageUrl为得到的图片base64数据，这里可以进行上传到服务器或者其他逻辑操作 */
                    var img = new Image();
                    img.src = imageUrl;
                    sumitImageFile(imageUrl)
                },
            });
        };
        //处理为file文件
        function sumitImageFile(base64Codes) {

            const formData = new FormData();
            var result = convertBase64UrlToBlob(base64Codes);
            formData.append('file', result, '手机2(2).jpg');
            $.ajax({
                url: "{:url('portal/list/avatarUpload')}", //上传接口
                type: 'POST',
                cache: false,
                data: formData,
                processData: false,
                contentType: false
            })

                .done(function (data) {
          
                    var re = JSON.parse(data);
                    result = re.data.file;
                    var results = "/upload/" + result;
                    $('#demo1').attr('src', results); //图片链接（base64）
                    $('#yyzz').attr('value',result); //图片链接（base64）
                  
                    return false;
                })
        }

    	/**  
    	 * 将以base64的图片url数据转换为Blob  
    	 * @param urlData  
    	 *            用url方式表示的base64图片数据  
    	 */
        function convertBase64UrlToBlob(urlData) {

            var bytes = window.atob(urlData.split(',')[1]);        //去掉url的头，并转换为byte  

            //处理异常,将ascii码小于0的转换为大于0  
            var ab = new ArrayBuffer(bytes.length);
            console.log(ab)
            var ia = new Uint8Array(ab);
            for (var i = 0; i < bytes.length; i++) {
                ia[i] = bytes.charCodeAt(i);
            }

            return new Blob([ia], { type: 'image/png' })
        }
    </script>
</body>

</html>